<h1>Lista de productos</h1>

<ul>
    {{#each products}}
    <li>
        <strong>{{this.title}}</strong>
        <br>
        <img src="{{this.thumbnails.[0]}}" alt="{{this.title}}" width="150">
        <br>
        <p>{{this.description}}</p>
        <strong> ${{this.price}}</strong>
        <button class="btn btn-dark add-to-cart" data-pid="{{this._id}}">Agregar a carrito</button>
    </li>
    {{/each}}
</ul>

<!-- Botón oculto que se muestra al agregar un producto -->
<div id="goToCartContainer" style="margin-top:20px; display:none;">
    <a id="goToCartBtn" class="btn btn-success">Ir al carrito</a>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll(".add-to-cart");
    const goToCartContainer = document.getElementById("goToCartContainer");
    const goToCartBtn = document.getElementById("goToCartBtn");

    buttons.forEach(btn => {
        btn.addEventListener("click", async () => {
            let cartId = localStorage.getItem("cartId");
            const productId = btn.dataset.pid;

            // Si no hay carrito, lo creamos
            if (!cartId) {
                const resp = await fetch("/api/carts", { method: "POST" });
                const data = await resp.json();
                cartId = data.cart._id;
                localStorage.setItem("cartId", cartId);
            }

            // Agregamos producto al carrito
            await fetch(`/api/carts/${cartId}/products/${productId}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ quantity: 1 })
            });

            // Mostrar botón "Ir al carrito"
            goToCartContainer.style.display = "block";
            goToCartBtn.href = `/api/carts/${cartId}/view`;
        });
    });
});
</script>




<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }

    h1 {
        color: #000000;
        text-align: center;
        margin-bottom: 100px;
    }

    ul {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        list-style-type: none;
        margin: 0;
        padding: 0;
    }

    li {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        min-height: 500px;
        background: #fff;
        border: 2px solid #000;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }

    li strong {
        margin-bottom: 10px;
        font-size: 1.2em;
    }

    li em {
        flex-grow: 1;
        display: flex;
        align-items: center;
        text-align: center;
    }

    li img {
        max-width: 120px;
        height: auto;
        margin-bottom: 15px;
    }

    li span.precio {
        font-weight: bold;
        margin-top: 10px;
    }
</style>